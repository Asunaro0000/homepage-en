<!doctype html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1NCR09VMKR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1NCR09VMKR');
  </script>
  
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PrismCat Memory | Asunaro Works</title>

  <!-- This page is under /gallery/prismcat/, so shared CSS is referenced with ../../ -->
  <link rel="stylesheet" href="../../css/style.css"/>
  <link rel="stylesheet" href="../../css/header.css">

  <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
  <header class="nav">
    <a class="brand" href="../../">Asunaro Works</a>
    <nav>
      <a href="../../gallery/">Gallery</a>
      <a href="../../about/">About</a>
      <a href="../../process/">Process</a>
      <a href="../../contact/">Contact</a>
      <a href="../../link/">Link</a>
      <a href="../../sitemap/">Sitemap</a>
      <a href="https://asunaro0000.github.io/asunaro0000.homepage/gallery/prismcat/">üåê JP</a>
    </nav>
  </header>

  <main>
    <section id="series-hero" class="section"></section>
    <section id="phases" class="cards"></section>
  </main>

  <footer>¬© 2025 Asunaro Works. All rights reserved.</footer>

  <script type="module">
    import { loadYAML } from '../../js/util/yaml-loader.js';

    /** Build a relative URL based on current directory depth */
    function relToRoot(p){
      if (!p) return p;
      p = String(p).replace(/^\/+/, '');
      const path = location.pathname.replace(/index\.html$/,'');
      const depth = Math.max(path.split('/').filter(Boolean).length - 1, 0);
      return (depth ? '../'.repeat(depth) : './') + p;
    }

    /** Convert to relative path inside this work (/gallery/prismcat/) */
    function relToWork(p){
      if (!p) return p;
      p = String(p).replace(/^\/+/, '');
      if (p.startsWith('assets/')) return './' + p;
      return p;
    }

    (async ()=>{
      // YAML at data/series/prismcat.yaml
      const data = await loadYAML('../../data/series/prismcat.yaml');
      const s = data.series;

      // Cover image
      const cover = s.cover || (s.phases?.[0]?.hero ?? '');
      const heroImg = relToWork(cover) || relToRoot(cover);

      const hero = document.getElementById('series-hero');
      hero.innerHTML = `
        <div class="figure">
          <img src="${heroImg}" alt="${s.title}">
        </div>
        <h1>${s.title}</h1>
        <p class="muted">${s.description || ''}</p>
      `;

      // Phase List
      const phases = document.getElementById('phases');
      phases.innerHTML = (s.phases || []).map(p => {
        const raw = p.hero || p.background || '';
        const thumb = relToWork(raw) || relToRoot(raw);
        const link  = `./${p.id}/`;
        return `
          <a class="card" href="${link}">
            ${thumb ? `<img src="${thumb}" alt="${p.title}" loading="lazy">` : ''}
            <div class="body">
              <h3>${p.title}</h3>
              <p>${p.caption || ''}</p>
            </div>
          </a>
        `;
      }).join('');
    })();
  </script>

  <script type="module" src="../../js/extensions/nav-toggle.js"></script>
</body>
</html>
